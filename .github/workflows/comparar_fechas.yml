name: Comparar Fechas y Subir a OneDrive

on:
  workflow_dispatch:   # Ejecutar manual
  #schedule:
  #  - cron: "0 10 * * *"  # Todos los dÃ­as a las 10:00 UTC

jobs:
  procesar:
    runs-on: ubuntu-latest

    steps:
    # 1ï¸âƒ£ Clonar repositorio
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v3

    # 2ï¸âƒ£ Configurar Python
    - name: ðŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3ï¸âƒ£ Instalar dependencias
    - name: ðŸ“¦ Instalar librerÃ­as
      run: pip install -r requirements.txt && pip install webdriver-manager

    # 4ï¸âƒ£ Crear carpeta local data/
    - name: ðŸ“ Crear carpeta data/
      run: mkdir -p data

    # 5ï¸âƒ£ Instalar Rclone
    - name: âš™ï¸ Instalar Rclone
      run: curl https://rclone.org/install.sh | sudo bash

    # 6ï¸âƒ£ Descargar archivos desde OneDrive
    - name: ðŸ“¥ Descargar archivos desde OneDrive
      env:
        AUTOMATE_RCLONE: ${{ secrets.AUTOMATE_RCLONE }}
      run: |
        echo "$AUTOMATE_RCLONE" > rclone.conf
        rclone --config rclone.conf copy "ondri_a.formularios:a.Formularios/Forms Cierre de Voluntariado.xlsx" data/
        rclone --config rclone.conf copy "ondri_a.formularios:a.Formularios/Te damos la bienvenida__DirecciÃ³n de Cultura Organizacional y Talento Humano.xlsx" data/
        rclone --config rclone.conf copy "ondri_a.formularios:a.Formularios/DNI_OBS.xlsx" data/

    # 7ï¸âƒ£ Ejecutar Script 1 (merge y observaciones de fechas)
    - name: â–¶ï¸ Ejecutar Script 1
      run: python COMPARACION_GLOBAL.py
      
    # 7ï¸âƒ£ Ejecutar Script 2 (test certificado)
    - name: â–¶ï¸ Ejecutar Script 2
      run: python certificados.py
    
    # 7ï¸âƒ£ Ejecutar Script 1 (merge y observaciones de fechas)
   # - name: â–¶ï¸ Ejecutar Script 1
    #  run: python script_merge.py
    
   # 8ï¸âƒ£ Ejecutar Script 2 (Selenium)
  # - name: â–¶ï¸ Ejecutar Script 2
   #   run: python script_selenium.py

   # 8ï¸âƒ£ Ejecutar Script 3 (SUNAT)
   # - name: â–¶ï¸ Ejecutar Script 3
    #  run: python comparar_con_sunat.py
    
    # ðŸ“¦ Subir carpeta DEBUG_FOLDER como artefacto
    - name: ðŸ“¤ Subir carpeta DEBUG_FOLDER
      uses: actions/upload-artifact@v4
      with:
        name: debug-folder
        path: DEBUG_FOLDER
    
 # 9ï¸âƒ£ Subir Excel final de comparaciÃ³n
    - name: â˜ï¸ Subir Excel de comparaciÃ³n
      env:
        AUTOMATE_RCLONE: ${{ secrets.AUTOMATE_RCLONE }}
      run: |
        echo "$AUTOMATE_RCLONE" > rclone.conf
        # Solo sube el Excel que comienza con DNI_resultado_comparacion_filtrado_
        rclone --config rclone.conf copy TEST_salida/ "ondri_a.formularios:a.Formularios/" --include "DNI_resultado_comparacion_filtrado_*.xlsx" --progress

    # ðŸ”Ÿ Subir carpeta con certificados PDF
    - name: â˜ï¸ Subir certificados PDF
      env:
        AUTOMATE_RCLONE: ${{ secrets.AUTOMATE_RCLONE }}
      run: |
        echo "$AUTOMATE_RCLONE" > rclone.conf
        rclone --config rclone.conf copy TEST_salida/certificados_pdf/ "ondri_a.formularios:a.Formularios/certificados_pdf/" --include "*.pdf" --progress


