name: Comparar Fechas y Subir a OneDrive

on:
  workflow_dispatch:   # Ejecutar manual
  #schedule:
  #  - cron: "0 10 * * *"  # Todos los dÃ­as a las 10:00 UTC

jobs:
  procesar:
    runs-on: ubuntu-latest

    steps:
    # 1ï¸âƒ£ Clonar repositorio
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v3

    # 2ï¸âƒ£ Configurar Python
    - name: ðŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3ï¸âƒ£ Instalar dependencias
    - name: ðŸ“¦ Instalar librerÃ­as
      run: pip install -r requirements.txt

    # 4ï¸âƒ£ Crear carpeta local data/
    - name: ðŸ“ Crear carpeta data/
      run: mkdir -p data

    # 5ï¸âƒ£ Instalar Rclone
    - name: âš™ï¸ Instalar Rclone
      run: curl https://rclone.org/install.sh | sudo bash

    # 6ï¸âƒ£ Descargar archivos desde OneDrive
    - name: ðŸ“¥ Descargar archivos desde OneDrive
      env:
        RCLONE_CONFIG: ${{ secrets.AUTOMATE_RCLONE}}
      run: |
        echo "$AUTOMATE_RCLONE" > rclone.conf
        rclone --config rclone.conf copy "ondri_a.formularios:a.Formularios/Forms Cierre de Voluntariado.xlsx" data/
        rclone --config rclone.conf copy "ondri_a.formularios:a.Formularios/Te damos la bienvenida__DirecciÃ³n de Cultura Organizacional y Talento Humano.xlsx" data/

    # 7ï¸âƒ£ Ejecutar Script 1 (merge y observaciones de fechas)
    - name: â–¶ï¸ Ejecutar Script 1
      run: python script_merge.py

    # 8ï¸âƒ£ Ejecutar Script 2 (Selenium)
    - name: â–¶ï¸ Ejecutar Script 2
      run: python script_selenium.py

    # 9ï¸âƒ£ Subir archivo final a OneDrive
    - name: â˜ï¸ Subir archivo final
      env:
        RCLONE_CONFIG: ${{ secrets.AUTOMATE_RCLONE}}
      run: |
        echo "$AUTOMATE_RCLONE" > rclone.conf
        FECHA=$(date +'%Y-%m-%d')
        ARCHIVO="resultado_observaciones_$FECHA.xlsx"
        rclone --config rclone.conf copy "TEST_salida/$ARCHIVO" "ondri_a.formularios:a.Formularios/" --progress
